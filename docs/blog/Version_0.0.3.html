<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta http-equiv="content-security-policy" content="">
		<link href="../_app/immutable/assets/_layout-8003c18b.css" rel="stylesheet">
		<link href="../_app/immutable/assets/_page-d97f4a66.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/start-aca0e6ba.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index-b0905f39.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/singletons-4e3a929d.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index-4b71bf5b.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/preload-helper-41c905a7.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/control-e7f5239e.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/parse-b67c4dc9.js">
		<link rel="modulepreload" href="../_app/immutable/components/layout.svelte-afe953a1.js">
		<link rel="modulepreload" href="../_app/immutable/modules/pages/_layout.ts-9cbb603b.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/_layout-da46b06b.js">
		<link rel="modulepreload" href="../_app/immutable/components/pages/blog/_layout.svelte-3bb0ca78.js">
		<link rel="modulepreload" href="../_app/immutable/components/pages/blog/_path_/_page.svelte-408e1e2a.js">
		<link rel="modulepreload" href="../_app/immutable/modules/pages/blog/_path_/_page.js-17edcf96.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/_page-97511be2.js"><!-- HEAD_svelte-3vh2vb_START --><link rel="stylesheet" href="/pico.min.css"><style>nav {
        margin-left: 10%;
        margin-right: 10%;
      }
    </style><!-- HEAD_svelte-3vh2vb_END -->
	</head>
	<body>
		<div>



  
  <main class="container"><nav><ul><li><a href="/">Maja Webutveckling 2</a></li>
        <li><a href="/clicker">Clicker</a></li>
        <li><a href="/todo">Todo-List</a></li>
        <li><a href="/eliza">ElizaBot</a></li>
        <li><a href="/memory">Memory</a></li>
        <li><a href="/search">API Search</a></li>
        <li><a href="/blog">Blog</a></li></ul></nav>
    

  
<article class="svelte-1viwzin"><div class="head svelte-1viwzin"><h1 class="svelte-1viwzin">Version 0.0.3</h1>
        <p class="svelte-1viwzin">Last updated: 2023-04-17</p></div>
    <div class="article svelte-1viwzin"><h1>Availability</h1>
<h2>Description</h2>
<p>Now the website is starting to take more and more shape I decided to take advantage of the insanely powerful API that the website is using. Users can now see where a movie is available in Germany, Sweden, Austria, Switzerland, Canada and the US.</p>
<h2>Changes</h2>
<p>The following changes and implementations have been made in that version of the project:</p>
<ul><li>Fetch functions to the <a href="https://developers.themoviedb.org/3" rel="nofollow">TheMovieDB API</a> to get the availability of the movie</li>
<li>Styling the icons and <code>&lt;select&gt;</code> tag</li></ul>
<p>Bug fixes:</p>
<ul><li>Added redirect if user that is not logged in goes to the profile page</li></ul>
<h2>Features</h2>
<p>‚úÖ Movie availability üåç  </p>
<h2>Code</h2>
<p>In here some selected code will be explained more in depth.</p>
<p>movie/[id]/+page.svelte</p>
<pre class="language-html"><!-- HTML_TAG_START --><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ts<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> page <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'$app/stores'</span><span class="token punctuation">;</span>

    <span class="token keyword">export</span> <span class="token keyword">let</span> <span class="token literal-property property">data</span><span class="token operator">:</span> PageServerData<span class="token punctuation">;</span>
    <span class="token comment">// list of countries that the user can select from</span>
    <span class="token keyword">const</span> countries <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span><span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"Sweden"</span><span class="token punctuation">,</span> <span class="token literal-property property">code</span><span class="token operator">:</span><span class="token string">"SE"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span><span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"Germany"</span><span class="token punctuation">,</span> <span class="token literal-property property">code</span><span class="token operator">:</span><span class="token string">"DE"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span><span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"Austria"</span><span class="token punctuation">,</span> <span class="token literal-property property">code</span><span class="token operator">:</span><span class="token string">"AT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span><span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"Switzerland"</span><span class="token punctuation">,</span> <span class="token literal-property property">code</span><span class="token operator">:</span><span class="token string">"CH"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span><span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"Canada"</span><span class="token punctuation">,</span> <span class="token literal-property property">code</span><span class="token operator">:</span><span class="token string">"CA"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span><span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"USA"</span><span class="token punctuation">,</span> <span class="token literal-property property">code</span><span class="token operator">:</span><span class="token string">"US"</span><span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>movie-providers<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>providers<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selText<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title-text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Watch at:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selCountry<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">on:</span>change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>&#123;changeCountry&#125;</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>country<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>select country:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>
            <span class="token comment">&lt;!--Use svelte bindings to bind the selected country to the select element--></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>country<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>country<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">bind:</span>value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>&#123;selected&#125;</span><span class="token punctuation">></span></span>
                <span class="token comment">&lt;!--Loop over each country that is defined in the country variable--></span>
                &#123;#each countries as country&#125;
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>&#123;country&#125;</span><span class="token punctuation">></span></span>
                        &#123;country.name&#125;
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">></span></span>
                &#123;/each&#125;
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token comment">&lt;!--Check for each attribute of the details if it is available if so
    use the svelte &#123;#each&#125; to loop over each provider and display the icon--></span>
    &#123;#if details&#125;
        &#123;#if details.flatrate&#125;
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Flatrate<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
            &#123;#each details.flatrate as test&#125;
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>provider-logo<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://image.tmdb.org/t/p/w500&#123;test.logo_path&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            &#123;/each&#125;
        &#123;/if&#125;
        &#123;#if details.buy&#125;
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Buy<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
            &#123;#each details.buy as test&#125;
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>provider-logo<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://image.tmdb.org/t/p/w500&#123;test.logo_path&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            &#123;/each&#125;
        &#123;/if&#125;
        &#123;#if details.rent&#125;
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Rent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
            &#123;#each details.rent as test&#125;
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>provider-logo<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://image.tmdb.org/t/p/w500&#123;test.logo_path&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            &#123;/each&#125;
        &#123;/if&#125;
        &#123;#if details.free&#125;
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Free<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
            &#123;#each details.free as test&#125;
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>provider-logo<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://image.tmdb.org/t/p/w500&#123;test.logo_path&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            &#123;/each&#125;
        &#123;/if&#125;
    &#123;:else&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Not available in &#123;selected.name&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    &#123;/if&#125;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><!-- HTML_TAG_END --></pre>
<p>movie/[id]/+page.server.ts</p>
<pre class="language-ts"><!-- HTML_TAG_START --><code class="language-ts"><span class="token comment">// we need to add the provider request to our http GET request</span>
<span class="token comment">// so we add another fetch() behind the first</span>

<span class="token keyword">const</span> resAvailability <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>
 	<span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">https://api.themoviedb.org/3/movie/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>params<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/watch/providers?api_key=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">TMDB_API_KEY</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">&#96;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// now we convert the response to json if it was ok</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>resAvailability<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> movieAvailability <span class="token operator">=</span> <span class="token keyword">await</span> resAvailability<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// in the end we add the availability to the returned props</span>
<span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    props<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        movieAvailability<span class="token punctuation">,</span>
        <span class="token operator">...</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</code><!-- HTML_TAG_END --></pre>
<hr>
<br>
Commit: <a href="https://github.com/hartmann-jonas/movie-db-two/commit/7887de9940fc4394b4b60dbaf870c35a7d867bb2" target="_blank">Version 0.0.3</a>
<p>Published: 2023-04-03</p></div>
</article></main>


		<script type="module" data-sveltekit-hydrate="skuqy4">
			import { start } from "../_app/immutable/start-aca0e6ba.js";

			start({
				env: {},
				paths: {"assets":"","base":""},
				target: document.querySelector('[data-sveltekit-hydrate="skuqy4"]').parentNode,
				version: "1681738644203",
				hydrate: {
					node_ids: [0, 2, 7],
					data: [null,null,null],
					form: null,
					error: null
				}
			});
		</script>
	</div>
	</body>
	<style>
		body {
			margin: 0;
			padding: 0;
		}
	</style>
</html>
